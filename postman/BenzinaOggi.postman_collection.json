{
  "info": {
    "_postman_id": "3a2d3f2e-9b5a-4f3a-9f2a-3f9a2b5c7d8e",
    "name": "BenzinaOggi API (Core Plugin)",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "description": "Solo le API usate dal plugin WordPress: lista/ dettaglio distributori, aggiornamenti prezzi (CSV), forzatura singolo impianto, notifiche variazioni, subscriptions."
  },
  "item": [
    {
      "name": "Distributors (list)",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/distributors?city={{city}}&fuel={{fuel}}&brand={{brand}}&sort={{sort}}&lat={{lat}}&lon={{lon}}&limit={{limit}}",
          "host": ["{{baseUrl}}"],
          "path": ["api","distributors"],
          "query": [
            { "key": "city", "value": "{{city}}" },
            { "key": "fuel", "value": "{{fuel}}" },
            { "key": "brand", "value": "{{brand}}" },
            { "key": "sort", "value": "{{sort}}" },
            { "key": "lat", "value": "{{lat}}" },
            { "key": "lon", "value": "{{lon}}" },
            { "key": "limit", "value": "{{limit}}" }
          ]
        }
      },
      "description": "Endpoint principale usato dal plugin per la ricerca con filtri/paginazione."
    },
    {
      "name": "Distributor (detail)",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/distributor/{{impiantoId}}",
          "host": ["{{baseUrl}}"],
          "path": ["api","distributor","{{impiantoId}}"]
        }
      },
      "description": "Dettaglio distributore per pagina WordPress."
    },
    {
      "name": "Cron: Update prices (CSV)",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/cron/update-prices-daily?debug=false",
          "host": ["{{baseUrl}}"],
          "path": ["api","cron","update-prices-daily"],
          "query": [ { "key": "debug", "value": "false" } ]
        }
      },
      "description": "Cron giornaliero (Vercel) per aggiornare prezzi dal CSV MIMIT e inviare notifiche immediate."
    },
    {
      "name": "Force update distributor (CSV→fallback MISE)",
      "request": {
        "method": "POST",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/force-update-distributor?impiantoId={{impiantoId}}&force=true&debug=true",
          "host": ["{{baseUrl}}"],
          "path": ["api","force-update-distributor"],
          "query": [
            { "key": "impiantoId", "value": "{{impiantoId}}" },
            { "key": "force", "value": "true" },
            { "key": "debug", "value": "true" }
          ]
        }
      },
      "description": "Aggiorna un singolo impianto. Usa CSV come fonte primaria; MISE solo se il CSV non ha righe."
    },
    {
      "name": "Notify variations (latest)",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/cron/notify-variations?onlyDown=true&latest=true",
          "host": ["{{baseUrl}}"],
          "path": ["api","cron","notify-variations"],
          "query": [
            { "key": "onlyDown", "value": "true" },
            { "key": "latest", "value": "true" }
          ]
        }
      },
      "description": "Invia subito notifiche per le variazioni più recenti disponibili."
    },
    {
      "name": "Notify variations (by day)",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/cron/notify-variations?onlyDown=true&day=YYYY-MM-DD",
          "host": ["{{baseUrl}}"],
          "path": ["api","cron","notify-variations"],
          "query": [
            { "key": "onlyDown", "value": "true" },
            { "key": "day", "value": "YYYY-MM-DD" }
          ]
        }
      },
      "description": "Invia notifiche per un giorno specifico."
    },
    {
      "name": "Subscriptions: create/update",
      "request": {
        "method": "POST",
        "header": [ { "key": "Content-Type", "value": "application/json" } ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"externalId\": \"user-123\",\n  \"impiantoId\": {{impiantoId}},\n  \"fuelType\": \"{{fuelType}}\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/subscriptions",
          "host": ["{{baseUrl}}"],
          "path": ["api","subscriptions"]
        }
      },
      "description": "Crea/aggiorna una subscription (externalId + impianto + fuel)."
    },
    {
      "name": "Subscriptions: list externalIds",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/subscriptions?impiantoId={{impiantoId}}&fuelType={{fuelType}}",
          "host": ["{{baseUrl}}"],
          "path": ["api","subscriptions"],
          "query": [
            { "key": "impiantoId", "value": "{{impiantoId}}" },
            { "key": "fuelType", "value": "{{fuelType}}" }
          ]
        }
      },
      "description": "Ritorna gli externalId iscritti a (impiantoId, fuelType)."
    }
  ],
  "event": [],
  "variable": [
    { "key": "baseUrl", "value": "http://localhost:3000" },
    { "key": "city", "value": "" },
    { "key": "fuel", "value": "" },
    { "key": "brand", "value": "" },
    { "key": "sort", "value": "" },
    { "key": "lat", "value": "" },
    { "key": "lon", "value": "" },
    { "key": "limit", "value": "200" },
    { "key": "impiantoId", "value": "59183" },
    { "key": "fuelType", "value": "Benzina" }
  ]
}

