{
  "info": {
    "_postman_id": "3a2d3f2e-9b5a-4f3a-9f2a-3f9a2b5c7d8e",
    "name": "BenzinaOggi API",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "description": "Collection completa per BenzinaOggi API: import anagrafica, prezzi, variazioni, distributori, dettagli e notifiche OneSignal. Include autenticazione Bearer token per endpoint protetti."
  },
  "item": [
    {
      "name": "Update Anagrafica",
      "request": {
        "method": "GET",
        "header": [
          { "key": "Authorization", "value": "Bearer {{apiSecret}}" }
        ],
        "url": {
          "raw": "{{baseUrl}}/api/update-anagrafica",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "update-anagrafica"
          ]
        }
      },
      "description": "Importa tutti i distributori dal CSV MISE. Aggiorna il database con anagrafica completa."
    },
    {
      "name": "List All Distributors",
      "request": {
        "method": "GET",
        "header": [
          { "key": "Authorization", "value": "Bearer {{apiSecret}}" }
        ],
        "url": {
          "raw": "{{baseUrl}}/api/distributors-all",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "distributors-all"
          ]
        }
      },
      "description": "Lista tutti i distributori (id, bandiera, comune) per creazione pagine WordPress."
    },
    {
      "name": "Update Prezzi",
      "request": {
        "method": "GET",
        "header": [
          { "key": "Authorization", "value": "Bearer {{apiSecret}}" }
        ],
        "url": {
          "raw": "{{baseUrl}}/api/update-prezzi",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "update-prezzi"
          ]
        }
      },
      "description": "Importa prezzi carburanti dal CSV MISE. Aggiorna prezzi giornalieri per tutti i distributori."
    },
    {
      "name": "Check Variation",
      "request": {
        "method": "GET",
        "header": [
          { "key": "Authorization", "value": "Bearer {{apiSecret}}" }
        ],
        "url": {
          "raw": "{{baseUrl}}/api/check-variation",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "check-variation"
          ]
        }
      },
      "description": "Controlla variazioni prezzi tra oggi e ieri. Restituisce distributori con cali/aumenti prezzi."
    },
    {
      "name": "List Distributors",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/distributors?city={{city}}&fuel={{fuel}}&brand={{brand}}&sort={{sort}}&lat={{lat}}&lon={{lon}}&limit={{limit}}",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "distributors"
          ],
          "query": [
            { "key": "city", "value": "{{city}}", "description": "Filtro per città (opzionale, case-insensitive)" },
            { "key": "fuel", "value": "{{fuel}}", "description": "Filtro per carburante (opzionale)" },
            { "key": "brand", "value": "{{brand}}", "description": "Filtro per bandiera (opzionale)" },
            { "key": "sort", "value": "{{sort}}", "description": "Ordina: nearest (richiede lat/lon) o cheapest" },
            { "key": "lat", "value": "{{lat}}", "description": "Latitudine utente per sort=nearest" },
            { "key": "lon", "value": "{{lon}}", "description": "Longitudine utente per sort=nearest" },
            { "key": "limit", "value": "{{limit}}", "description": "Numero massimo risultati (default 200)" }
          ]
        }
      },
      "description": "Lista distributori con filtri avanzati (città, carburante, bandiera) e ordinamento (più vicino, più economico)."
    },
    {
      "name": "Distributor Detail",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/distributor/{{impiantoId}}",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "distributor",
            "{{impiantoId}}"
          ]
        }
      },
      "description": "Dettagli completi di un distributore specifico con prezzi aggiornati. Usato per pagine WordPress."
    },
    {
      "name": "Send Notification",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Authorization", "value": "Bearer {{apiSecret}}" },
          { "key": "Content-Type", "value": "application/json" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"fuelType\": \"Benzina\",\n  \"distributorId\": \"1001\",\n  \"oldPrice\": 1.500,\n  \"newPrice\": 1.450,\n  \"distributorName\": \"Esempio Distributore\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/send-notification",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "send-notification"
          ]
        },
        "description": "Invia notifica OneSignal per calo prezzo carburante. Richiede: fuelType, distributorId, oldPrice, newPrice, distributorName"
      }
    },
    {
      "name": "Test Notification",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Authorization", "value": "Bearer {{apiSecret}}" },
          { "key": "Content-Type", "value": "application/json" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"fuelType\": \"Benzina\",\n  \"distributorId\": \"1001\",\n  \"oldPrice\": 1.500,\n  \"newPrice\": 1.450,\n  \"distributorName\": \"Test Distributore\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/test-notification",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "test-notification"
          ]
        },
        "description": "Test endpoint per verificare la preparazione delle notifiche senza inviare effettivamente via OneSignal. SOLUZIONE: Usa il plugin ufficiale OneSignal per WordPress per risolvere automaticamente il Service Worker 404"
      }
    }
  ],
  "event": [],
  "variable": [
    { "key": "baseUrl", "value": "http://localhost:3000" },
    { "key": "apiSecret", "value": "" },
    { "key": "scope", "value": "active" },
    { "key": "city", "value": "" },
    { "key": "fuel", "value": "" },
    { "key": "brand", "value": "" },
    { "key": "sort", "value": "" },
    { "key": "lat", "value": "" },
    { "key": "lon", "value": "" },
    { "key": "limit", "value": "200" },
    { "key": "impiantoId", "value": "1001" },
    { "key": "fuelType", "value": "Benzina" },
    { "key": "distributorId", "value": "1001" },
    { "key": "oldPrice", "value": "1.500" },
    { "key": "newPrice", "value": "1.450" },
    { "key": "distributorName", "value": "Esempio Distributore" }
  ]
}

